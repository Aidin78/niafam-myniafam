!function(){"use strict";var e=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t},t=function(t){return function(r){return e(r)===t}},r=t("string"),o=t("object"),n=t("array"),a=t("null"),s=t("boolean"),i=t("undefined"),c=t("function"),l=t("number"),u=function(e,t,r){for(var o=e.length,n=new Array(o),a=0;a<o-1;a++){var s=e[a];n[a]=r(t(s))}return o>0&&(n[o-1]=t(e[o-1])),n},d=function(e){return{eq:e}},p=d((function(e,t){return e===t})),m=p,g=p,h=p,f=p,y=function(e){return d((function(t,r){if(t.length!==r.length)return!1;for(var o=t.length,n=0;n<o;n++)if(!e.eq(t[n],r[n]))return!1;return!0}))},b=d((function(t,r){if(t===r)return!0;var o,n=e(t);return n===e(r)&&(function(e){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(e)}(n)?t===r:"array"===n?y(b).eq(t,r):"object"===n&&(o=b,d((function(e,t){var r=Object.keys(e),n=Object.keys(t);if(!function(e,t){return function(e,t){return d((function(r,o){return e.eq(t(r),t(o))}))}(y(e),(function(e){return function(e,t){return Array.prototype.slice.call(e).sort(t)}(e,t)}))}(m).eq(r,n))return!1;for(var a=r.length,s=0;s<a;s++){var i=r[s];if(!o.eq(e[i],t[i]))return!1}return!0}))).eq(t,r))})),v=function(e){return'"'+e.replace(/"/g,'\\"')+'"'},w=function(e){return{show:e}},x=function(e){return w((function(){return e}))},T=w((function(e){return String(e)})),A=x("undefined"),E=x("null"),k=T,S=T,C=w((function(e){return v(e)})),j=x("function() {...}"),O=function(){return O=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},O.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var $=function(e,t,r){return{start:e,children:t,end:r}},_=function(e){return t=function(t){return t+e},function(e){return(r=t(e.end),function(e){return O(O({},e),{end:r})})(e);var r};var t},U=function(e){return{pprint:e}},N=function(e){return U((function(t){return r=e.show(t),$(r,[],"");var r}))},R=N(A),P=N(E),M=N(C),z=N(k),I=N(S),B=N(j),L=N(T),q=function(e){return U((function(t){var r=function(e){for(var t=[],r=Object.keys(e),o=r.length,n=0;n<o;n++){var a=r[n],s=e[a];t.push([a,s])}return t}(t),o=u(r,(function(t){var r,o,n=t[0],a=t[1],s=e.pprint(a),i=v(n)+": ";return(r=i,o=function(e){return r+e},function(e){return(t=o(e.start),function(e){return O(O({},e),{start:t})})(e);var t})(s)}),_(","));return $("{",o,"}")}))},D=U((function(e){return i(e)?R.pprint(e):a(e)?P.pprint(e):l(e)?I.pprint(e):s(e)?z.pprint(e):c(e)?B.pprint(e):r(e)?M.pprint(e):n(e)?(t=D,U((function(e){var r=u(e,t.pprint,_(","));return $("[",r,"]")}))).pprint(e):o(e)?q(D).pprint(e):L.pprint(e);var t})),K=function(e,t){return O(O({},e),t)};K(h,R),K(f,P),K(m,M),K(g,I),K(b,D),K(p,D);const F=Object.getPrototypeOf,V=(e,t,r)=>{var o;return!!r(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},W=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&V(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":t})(t)===e,H=e=>t=>typeof t===e,G=e=>t=>e===t,J=W("string"),X=W("object"),Y=e=>((e,t)=>X(e)&&V(e,t,((e,t)=>F(e)===t)))(e,Object),Q=W("array"),Z=G(null),ee=H("boolean"),te=G(void 0),re=e=>null==e,oe=e=>!re(e),ne=H("function"),ae=H("number"),se=()=>{},ie=e=>()=>e,ce=e=>e,le=(e,t)=>e===t;function ue(e,...t){return(...r)=>{const o=t.concat(r);return e.apply(null,o)}}const de=e=>e(),pe=ie(!1),me=ie(!0);class ge{constructor(e,t){this.tag=e,this.value=t}static some(e){return new ge(!0,e)}static none(){return ge.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?ge.some(e(this.value)):ge.none()}bind(e){return this.tag?e(this.value):ge.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:ge.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return oe(e)?ge.some(e):ge.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}ge.singletonNone=new ge(!1);const he=Array.prototype.indexOf,fe=Array.prototype.push,ye=(e,t)=>{return r=e,o=t,he.call(r,o)>-1;var r,o},be=(e,t)=>{for(let r=0,o=e.length;r<o;r++)if(t(e[r],r))return!0;return!1},ve=(e,t)=>{const r=[];for(let o=0;o<e;o++)r.push(t(o));return r},we=(e,t)=>{const r=e.length,o=new Array(r);for(let n=0;n<r;n++){const r=e[n];o[n]=t(r,n)}return o},xe=(e,t)=>{for(let r=0,o=e.length;r<o;r++)t(e[r],r)},Te=(e,t)=>{const r=[];for(let o=0,n=e.length;o<n;o++){const n=e[o];t(n,o)&&r.push(n)}return r},Ae=(e,t,r)=>(xe(e,((e,o)=>{r=t(r,e,o)})),r),Ee=(e,t)=>((e,t,r)=>{for(let o=0,n=e.length;o<n;o++){const n=e[o];if(t(n,o))return ge.some(n);if(r(n,o))break}return ge.none()})(e,t,pe),ke=(e,t)=>(e=>{const t=[];for(let r=0,o=e.length;r<o;++r){if(!Q(e[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+e);fe.apply(t,e[r])}return t})(we(e,t)),Se=(e,t)=>{for(let r=0,o=e.length;r<o;++r)if(!0!==t(e[r],r))return!1;return!0},Ce=(e,t)=>t>=0&&t<e.length?ge.some(e[t]):ge.none(),je=e=>Ce(e,0),Oe=Object.keys,$e=Object.hasOwnProperty,_e=(e,t)=>{const r=Oe(e);for(let o=0,n=r.length;o<n;o++){const n=r[o];t(e[n],n)}},Ue=(e,t)=>{const r={};var o;return((e,t,r,o)=>{_e(e,((e,n)=>{(t(e,n)?r:o)(e,n)}))})(e,t,(o=r,(e,t)=>{o[t]=e}),se),r},Ne=(e,t)=>Re(e,t)?ge.from(e[t]):ge.none(),Re=(e,t)=>$e.call(e,t),Pe=e=>{if(!Q(e))throw new Error("cases must be an array");if(0===e.length)throw new Error("there must be at least one case");const t=[],r={};return xe(e,((o,n)=>{const a=Oe(o);if(1!==a.length)throw new Error("one and only one name per case");const s=a[0],i=o[s];if(void 0!==r[s])throw new Error("duplicate key detected:"+s);if("cata"===s)throw new Error("cannot have a case named cata (sorry)");if(!Q(i))throw new Error("case arguments must be an array");t.push(s),r[s]=(...r)=>{const o=r.length;if(o!==i.length)throw new Error("Wrong number of arguments to case "+s+". Expected "+i.length+" ("+i+"), got "+o);return{fold:(...t)=>{if(t.length!==e.length)throw new Error("Wrong number of arguments to fold. Expected "+e.length+", got "+t.length);return t[n].apply(null,r)},match:e=>{const o=Oe(e);if(t.length!==o.length)throw new Error("Wrong number of arguments to match. Expected: "+t.join(",")+"\nActual: "+o.join(","));if(!Se(t,(e=>ye(o,e))))throw new Error("Not all branches were specified when using match. Specified: "+o.join(", ")+"\nRequired: "+t.join(", "));return e[s].apply(null,r)},log:e=>{console.log(e,{constructors:t,constructor:s,params:r})}}}})),r},Me=e=>{const t=t=>t(e),r=ie(e),o=()=>n,n={tag:!0,inner:e,fold:(t,r)=>r(e),isValue:me,isError:pe,map:t=>Ie.value(t(e)),mapError:o,bind:t,exists:t,forall:t,getOr:r,or:o,getOrThunk:r,orThunk:o,getOrDie:r,each:t=>{t(e)},toOptional:()=>ge.some(e)};return n},ze=e=>{const t=()=>r,r={tag:!1,inner:e,fold:(t,r)=>t(e),isValue:pe,isError:me,map:t,mapError:t=>Ie.error(t(e)),bind:t,exists:pe,forall:me,getOr:ce,or:ce,getOrThunk:de,orThunk:de,getOrDie:(o=String(e),()=>{throw new Error(o)}),each:se,toOptional:ge.none};var o;return r},Ie={value:Me,error:ze,fromOption:(e,t)=>e.fold((()=>ze(t)),Me)};"undefined"!=typeof window?window:Function("return this;")();const Be=(e,t,r)=>Math.min(Math.max(e,t),r);let Le=0;const qe=e=>{const t=(new Date).getTime(),r=Math.floor(window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295*1e9);return Le++,e+"_"+r+Le+String(t)},De=(Ke=(e,t)=>Y(e)&&Y(t)?De(e,t):t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let r=0;r<e.length;r++){const o=e[r];for(const e in o)Re(o,e)&&(t[e]=Ke(t[e],o[e]))}return t});var Ke;const Fe=(e,t,r,o)=>e.isSome()&&t.isSome()&&r.isSome()?ge.some(o(e.getOrDie(),t.getOrDie(),r.getOrDie())):ge.none(),Ve=(e,t)=>e?ge.some(t):ge.none();Pe([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);const We=()=>{const e=(e=>{const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(ge.none()),r=()=>t.get().each(e);return{clear:()=>{r(),t.set(ge.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{r(),t.set(ge.some(e))}}})(se);return{...e,on:t=>e.get().each(t)}},He=Pe([{starts:["value","f"]},{pattern:["regex","f"]},{contains:["value","f"]},{exact:["value","f"]},{all:[]},{not:["stringMatch"]}]);He.starts,He.pattern,He.contains,He.exact,He.all,He.not;const Ge=(e,t,r)=>""===t||e.length>=t.length&&e.substr(r,r+t.length)===t,Je=(e,t,r=0,o)=>{const n=e.indexOf(t,r);return-1!==n&&(!!te(o)||n+t.length<=o)},Xe=(e,t)=>Ge(e,t,0),Ye=(Qe=/^\s+|\s+$/g,e=>e.replace(Qe,""));var Qe;const Ze=(e,t=10)=>{const r=parseInt(e,t);return isNaN(r)?ge.none():ge.some(r)},et=(e,t)=>{let r=null;const o=()=>{Z(r)||(clearTimeout(r),r=null)};return{cancel:o,throttle:(...n)=>{o(),r=setTimeout((()=>{r=null,e.apply(null,n)}),t)}}};var tt;!function(e){e[e.Error=0]="Error",e[e.Value=1]="Value"}(tt||(tt={}));const rt=(e,t,r)=>e.stype===tt.Error?t(e.serror):r(e.svalue),ot=e=>({stype:tt.Value,svalue:e}),nt=e=>({stype:tt.Error,serror:e}),at=rt,st=e=>X(e)&&Oe(e).length>100?" removed due to size":JSON.stringify(e,null,2),it=(e,t)=>nt([{path:e,getErrorInfo:t}]),ct=e=>({extract:(t,r)=>{return o=e(r),n=e=>((e,t)=>it(e,ie(t)))(t,e),o.stype===tt.Error?n(o.serror):o;var o,n},toString:ie("val")}),lt=(ut=J,"string",ct((e=>{const t=typeof e;return ut(e)?ot(e):nt(`Expected type: string but got: ${t}`)})));var ut;const dt=(e,t,r)=>{switch(e.tag){case"field":return t(e.key,e.newKey,e.presence,e.prop);case"custom":return r(e.newKey,e.instantiator)}},pt=(e,t,r,o)=>o(Ne(e,t).getOrThunk((()=>r(e)))),mt=(e,t,r,o,n)=>{const a=e=>n.extract(t.concat([o]),e),s=e=>e.fold((()=>ot(ge.none())),(e=>{const r=n.extract(t.concat([o]),e);return a=r,s=ge.some,a.stype===tt.Value?{stype:tt.Value,svalue:s(a.svalue)}:a;var a,s}));switch(e.tag){case"required":return((e,t,r,o)=>Ne(t,r).fold((()=>((e,t,r)=>it(e,(()=>'Could not find valid *required* value for "'+t+'" in '+st(r))))(e,r,t)),o))(t,r,o,a);case"defaultedThunk":return pt(r,o,e.process,a);case"option":return((e,t,r)=>r(Ne(e,t)))(r,o,s);case"defaultedOptionThunk":return((e,t,r,o)=>o(Ne(e,t).map((t=>!0===t?r(e):t))))(r,o,e.process,s);case"mergeWithThunk":return pt(r,o,ie({}),(t=>{const o=De(e.process(r),t);return a(o)}))}},gt=(e,t,r)=>{return o=((e,t,r)=>((e,t)=>e.stype===tt.Error?{stype:tt.Error,serror:t(e.serror)}:e)(t.extract([e],r),(e=>({input:r,errors:e}))))(e,t,r),rt(o,Ie.error,Ie.value);var o},ht=(e,t)=>((e,t,r,o)=>({tag:"field",key:e,newKey:t,presence:r,prop:o}))(e,e,{tag:"required",process:{}},t),ft=e=>{try{return!!J(e)&&(new URL(e),!0)}catch(e){return!1}},yt=e=>{const t=new URL(e);return t.pathname.endsWith("/")||(t.pathname=`${t.pathname}/`),t.toString()},bt=(vt=[("signature",ht("signature",lt)),ht("expire",ct((e=>(e=>{const t="Invalid expire value in uploadcare signature provider response must be a number or a parsable string";return ae(e)?Ie.value(e):J(e)?Ie.fromOption(Ze(e),t):Ie.error(t)})(e).fold(nt,ot))))],{extract:(e,t)=>((e,t,r)=>{const o={},n=[];for(const a of r)dt(a,((r,a,s,i)=>{const c=mt(s,e,t,r,i);at(c,(e=>{n.push(...e)}),(e=>{o[a]=e}))}),((e,r)=>{o[e]=r(t)}));return n.length>0?nt(n):ot(o)})(e,t,vt),toString:()=>{const e=we(vt,(e=>dt(e,((e,t,r,o)=>e+" -> "+o.toString()),((e,t)=>"state("+e+")"))));return"obj{\n"+e.join("\n")+"}"}});var vt;const wt=e=>async t=>{const r=e(t);return X(n=r)&&ne(n.then)&&ne(n.catch)?(o=await r,gt("uploadcare_signed_upload_auth_provider",bt,o).fold((e=>{return Promise.reject(new Error("Invalid uploadcare signature provider response.\n"+("Errors: \n"+(e=>{const t=e.length>10?e.slice(0,10).concat([{path:[],getErrorInfo:ie("... (only showing first ten failures)")}]):e;return we(t,(e=>"Failed path: ("+e.path.join(" > ")+")\n"+e.getErrorInfo()))})((t=e).errors).join("\n")+"\n\nInput object: "+st(t.input))));var t}),(e=>(ae(e.expire)?ge.some(e.expire):Ze(e.expire)).fold((()=>Promise.reject(new Error("Invalid expire value in uploadcare signature provider response must be a number or a parsable string"))),(t=>Promise.resolve({signature:e.signature,expire:t})))))):Promise.reject(new Error("Invalid signature provider response; expected a promise."));var o,n},xt=e=>{const t=e.options.get("uploadcare_public_key"),r=ge.from(e.options.get("uploadcare_signed_upload_auth_provider")).map(wt);if(!J(t))throw new Error("Uploadcare public key is not set");return{pubKey:t,signatureProvider:r}},Tt=e=>e.options.get("uploadcare_store_type"),At=e=>e.options.get("uploadcare_cdn_base_url"),Et=e=>ge.from(e.options.get("uploadcare_upload_base_url")),kt=e=>e.options.get("uploadcare_srcset_steps"),St=e=>e.options.get("a11y_advanced_options"),Ct=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},jt=(e,t)=>{const r=(t||document).createElement(e);return Ct(r)},Ot=Ct,$t=Pe([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]);$t.ltr,$t.rtl;const _t=(e,t)=>{const r=e.dom;if(1!==r.nodeType)return!1;{const e=r;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},Ut=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,Nt=e=>t=>(e=>e.dom.nodeType)(t)===e,Rt=Nt(1),Pt=Nt(3),Mt=Nt(11),zt=e=>Ot(e.dom.host),It=e=>{const t=Ot((e=>{if(oe(e.target)){const t=Ot(e.target);if(Rt(t)&&oe(t.dom.shadowRoot)&&e.composed&&e.composedPath){const t=e.composedPath();if(t)return je(t)}}return ge.from(e.target)})(e).getOr(e.target)),r=()=>e.stopPropagation(),o=()=>e.preventDefault(),n=(a=o,s=r,(...e)=>a(s.apply(null,e)));var a,s;return((e,t,r,o,n,a,s)=>({target:e,x:t,y:r,stop:o,prevent:n,kill:a,raw:s}))(t,e.clientX,e.clientY,r,o,n,e)},Bt=(e,t,r,o,n)=>{const a=((e,t)=>r=>{e(r)&&t(It(r))})(r,o);return e.dom.addEventListener(t,a,n),{unbind:ue(Lt,e,t,a,n)}},Lt=(e,t,r,o)=>{e.dom.removeEventListener(t,r,o)},qt=me,Dt=(e,t,r)=>((e,t,r,o)=>Bt(e,t,r,o,!1))(e,t,qt,r),Kt=(e,t)=>{const r=(e=>ge.from(e.dom.parentNode).map(Ot))(e);r.each((r=>{r.dom.insertBefore(t.dom,e.dom)}))},Ft=(e,t)=>{e.dom.appendChild(t.dom)},Vt=(e,t,r)=>{if(!(J(r)||ee(r)||ae(r)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")},Wt=(e,t,r)=>{Vt(e.dom,t,r)},Ht=(e,t)=>{const r=e.dom;_e(t,((e,t)=>{Vt(r,t,e)}))},Gt=(e,t)=>{const r=e.dom.getAttribute(t);return null===r?void 0:r},Jt=(e,t)=>ge.from(Gt(e,t)),Xt=(e,t)=>{const r=e.dom;return!(!r||!r.hasAttribute)&&r.hasAttribute(t)},Yt=(e,t)=>{e.dom.removeAttribute(t)},Qt=e=>Ae(e.dom.attributes,((e,t)=>(e[t.name]=t.value,e)),{}),Zt=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},er=e=>new Promise(((t,r)=>{const o=()=>{a(),t(e)},n=[Dt(e,"load",o),Dt(e,"error",(()=>{a(),r("Unable to load data from image: "+e.dom.src)}))],a=()=>xe(n,(e=>e.unbind()));e.dom.complete&&o()})),tr=e=>void 0!==e.style&&ne(e.style.getPropertyValue),rr=e=>{const t=Pt(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;const r=t.ownerDocument;return(e=>{const t=(e=>Ot(e.dom.getRootNode()))(e);return Mt(r=t)&&oe(r.dom.host)?ge.some(t):ge.none();var r})(Ot(t)).fold((()=>r.body.contains(t)),(o=rr,n=zt,e=>o(n(e))));var o,n},or=(e,t,r)=>{if(!J(r))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);tr(e)&&e.style.setProperty(t,r)},nr=(e,t,r)=>{const o=e.dom;or(o,t,r)},ar=(e,t)=>{const r=e.dom;_e(t,((e,t)=>{or(r,t,e)}))},sr=(e,t)=>{const r=e.dom,o=window.getComputedStyle(r).getPropertyValue(t);return""!==o||rr(e)?o:ir(r,t)},ir=(e,t)=>tr(e)?e.style.getPropertyValue(t):"",cr=(e,t)=>{const r=e.dom,o=ir(r,t);return ge.from(o).filter((e=>e.length>0))},lr=(e,t)=>{((e,t)=>{tr(e)&&e.style.removeProperty(t)})(e.dom,t),((e,t,r=le)=>e.exists((e=>r(e,t))))(Jt(e,"style").map(Ye),"")&&Yt(e,"style")},ur=(e,t)=>{const r=r=>{const o=t(r);if(o<=0||null===o){const t=sr(r,e);return parseFloat(t)||0}return o},o=(e,t)=>Ae(t,((t,r)=>{const o=sr(e,r),n=void 0===o?0:parseInt(o,10);return isNaN(n)?t:t+n}),0);return{set:(t,r)=>{if(!ae(r)&&!r.match(/^[0-9]+$/))throw new Error(e+".set accepts only positive integer values. Value was "+r);const o=t.dom;tr(o)&&(o.style[e]=r+"px")},get:r,getOuter:r,aggregate:o,max:(e,t,r)=>{const n=o(e,r);return t>n?t-n:0}}},dr=ur("height",(e=>{const t=e.dom;return rr(e)?t.getBoundingClientRect().height:t.offsetHeight})),pr=ur("width",(e=>e.dom.offsetWidth));var mr=(e,t,r,o,n)=>e(r,o)?ge.some(r):ne(n)&&n(r)?ge.none():t(r,o,n);const gr=(e,t,r)=>{let o=e.dom;const n=ne(r)?r:pe;for(;o.parentNode;){o=o.parentNode;const e=Ot(o);if(t(e))return ge.some(e);if(n(e))break}return ge.none()},hr=(e,t,r)=>gr(e,(e=>_t(e,t)),r),fr=(e,t)=>((e,r)=>Ee(e.dom.childNodes,(e=>{return r=Ot(e),_t(r,t);var r})).map(Ot))(e),yr=(e,t)=>{(e=>void 0!==e.dom.classList)(e)?e.dom.classList.add(t):((e,t)=>{((e,t,r)=>{const o=((e,t)=>{const r=Gt(e,t);return void 0===r||""===r?[]:r.split(" ")})(e,t),n=o.concat([r]);Wt(e,t,n.join(" "))})(e,"class",t)})(e,t)},br=(e,t)=>((e,t)=>{const r=void 0===t?document:t.dom;return Ut(r)?[]:we(r.querySelectorAll(e),Ot)})(t,e),vr=Pe([{before:["element"]},{on:["element","offset"]},{after:["element"]}]);vr.before,vr.on,vr.after;const wr=Pe([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]);wr.domRange,wr.relative,wr.exact;const xr=["avif","bmp","gif","heic","jpeg","jpg","pcx","png","tga","tiff","webp"],Tr=e=>`image/${e}`,Ar=e=>{const t=(e=>e.options.get("images_file_types"))(e).split(",");return Te(xr,(e=>ye(t,e)))},Er=e=>Ar(e).map(Tr),kr=(e,t)=>Er(t).includes(e),Sr="The image is not a supported file format",Cr="Back",jr="Apply",Or="Reset",$r="Default",_r="Image",Ur="Face",Nr="Smart (content-aware)",Rr="Ratio {0}",Pr="Auto enhance",Mr=(e,t,r)=>{e.notificationManager.open({text:t,type:"error"}),((e,t)=>{console.error(e+"\n",t)})(t,r)},zr=e=>t=>Mr(e,e.translate(["Failed to upload image: {0}",t.message]),t),Ir=e=>t=>Mr(e,"Image operation failed",t);function Br(e){return"[object Object]"===Object.prototype.toString.call(e)}const Lr=/\W|_/g;function qr(e,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(e)?e.map((e=>Dr(e,{ignoreKeys:t}))):e}function Dr(e,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(e))return qr(e,{ignoreKeys:t});if(!Br(e))return e;const r={};for(const n of Object.keys(e)){let a=e[n];t.includes(n)?r[n]=a:(Br(a)?a=Dr(a,{ignoreKeys:t}):Array.isArray(a)&&(a=qr(a,{ignoreKeys:t})),r[(o=n,o.split(Lr).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join(""))]=a)}var o;return r}const Kr=e=>new Promise((t=>setTimeout(t,e))),Fr={factor:2,time:100};class Vr extends Error{}class Wr extends Vr{originalProgressEvent;constructor(e){super(),this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,Wr.prototype),this.originalProgressEvent=e}}const Hr=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))};class Gr extends Vr{isCancel=!0;constructor(e="Request canceled"){super(e),this.name="CancelError",Object.setPrototypeOf(this,Gr.prototype)}}const Jr=({check:e,interval:t=500,timeout:r,signal:o})=>new Promise(((n,a)=>{let s,i;Hr(o,(()=>{s&&clearTimeout(s),a(new Gr("Poll cancelled"))})),r&&(i=setTimeout((()=>{s&&clearTimeout(s),a(new Gr("Timed out"))}),r));const c=()=>{try{Promise.resolve(e(o)).then((e=>{e?(i&&clearTimeout(i),n(e)):s=setTimeout(c,t)})).catch((e=>{i&&clearTimeout(i),a(e)}))}catch(e){i&&clearTimeout(i),a(e)}};s=setTimeout(c,0)})),Xr="https://ucarecdn.com",Yr="https://upload.uploadcare.com",Qr=1,Zr=3,eo="79ae88bd931ea68464d9",to="application/octet-stream",ro=({method:e,url:t,data:r,headers:o={},signal:n,onProgress:a})=>new Promise(((s,i)=>{const c=new XMLHttpRequest,l=e?.toUpperCase()||"GET";let u=!1;c.open(l,t,!0),o&&Object.entries(o).forEach((e=>{const[t,r]=e;void 0!==r&&!Array.isArray(r)&&c.setRequestHeader(t,r)})),c.responseType="text",Hr(n,(()=>{u=!0,c.abort(),i(new Gr)})),c.onload=()=>{if(200!=c.status)i(new Error(`Error ${c.status}: ${c.statusText}`));else{const e={method:l,url:t,data:r,headers:o||void 0,signal:n,onProgress:a},i=c.getAllResponseHeaders().trim().split(/[\r\n]+/),u={};i.forEach((function(e){const t=e.split(": "),r=t.shift(),o=t.join(": ");r&&void 0!==r&&(u[r]=o)}));const d=c.response,p=c.status;s({request:e,data:d,headers:u,status:p})}},c.onerror=e=>{u||i(new Wr(e))},a&&"function"==typeof a&&(c.upload.onprogress=e=>{e.lengthComputable?a({isComputable:!0,value:e.loaded/e.total}):a({isComputable:!1})}),r?c.send(r):c.send()})),oo=({name:e})=>e?[e]:[],no=function(e,...t){return e};const ao=e=>"undefined"!=typeof Blob&&e instanceof Blob,so=e=>"undefined"!=typeof File&&e instanceof File,io=e=>!!e&&"object"==typeof e&&!Array.isArray(e)&&"uri"in e&&"string"==typeof e.uri,co=e=>"string"==typeof e||"number"==typeof e||void 0===e,lo=e=>!!e&&"object"==typeof e&&!Array.isArray(e),uo=e=>{return!!e&&"object"==typeof e&&"data"in e&&(t=e.data,ao(t)||so(t)||io(t));var t};function po(e,t,r){if(Array.isArray(r))for(const o of r)po(e,`${t}[]`,o);else if(uo(r)){const{name:o,contentType:n}=r,a=no(r.data,o,n??to),s=oo({name:o,contentType:n});e.push([t,a,...s])}else if(lo(r))for(const[o,n]of Object.entries(r))void 0!==n&&e.push([`${t}[${o}]`,String(n)]);else co(r)&&r&&e.push([t,r.toString()])}function mo(e){const t=new FormData,r=function(e){const t=[];for(const[r,o]of Object.entries(e))po(t,r,o);return t}(e);for(const e of r){const[r,o,...n]=e;t.append(r,o,...n)}return t}class go extends Vr{code;request;response;headers;constructor(e,t,r,o,n){super(),this.name="UploadError",this.message=e,this.code=t,this.request=r,this.response=o,this.headers=n,Object.setPrototypeOf(this,go.prototype)}}const ho=(e,t,r)=>{const o=new URL(e);return o.pathname=(o.pathname+t).replace("//","/"),r&&(o.search=(e=>{const t=new URLSearchParams;for(const[r,o]of Object.entries(e))o&&"object"==typeof o&&!Array.isArray(o)?Object.entries(o).filter((e=>e[1]??!1)).forEach((e=>t.set(`${r}[${e[0]}]`,String(e[1])))):Array.isArray(o)?o.forEach((e=>{t.append(`${r}[]`,e)})):"string"==typeof o&&o?t.set(r,o):"number"==typeof o&&t.set(r,o.toString());return t.toString()})(r)),o.toString()},fo="UploadcareUploadClient",yo="6.14.2";function bo(e){return function({libraryName:e,libraryVersion:t,userAgent:r,publicKey:o="",integration:n=""}){const a="JavaScript";return"string"==typeof r?r:"function"==typeof r?r({publicKey:o,libraryName:e,libraryVersion:t,languageName:a,integration:n}):`${[e,t,o].filter(Boolean).join("/")} (${[a,n].filter(Boolean).join("; ")})`}({libraryName:fo,libraryVersion:yo,...e})}const vo="RequestThrottledError",wo=15e3,xo=1e3;function To(e,t){const{retryThrottledRequestMaxTimes:r,retryNetworkErrorMaxTimes:o}=t;return function(e,t=Fr){let r=0;return function e(o){const n=Math.round(t.time*t.factor**r);return o({attempt:r,retry:t=>Kr(t??n).then((()=>(r+=1,e(o))))})}(e)}((({attempt:t,retry:n})=>e().catch((e=>{if("response"in e&&e?.code===vo&&t<r)return n(function(e){const{headers:t}=e||{};if(!t||"string"!=typeof t["retry-after"])return wo;const r=parseInt(t["retry-after"],10);return Number.isFinite(r)?1e3*r:wo}(e));if(e instanceof Wr&&t<o)return n((t+1)*xo);throw e}))))}const Ao=e=>{let t="";return(ao(e)||so(e)||io(e))&&(t=e.type),t||to},Eo=e=>{let t="";return so(e)&&e.name?t=e.name:ao(e)?t="":io(e)&&e.name&&(t=e.name),t||"original"};function ko(e){return void 0===e||"auto"===e?"auto":e?"1":"0"}var So,Co;!function(e){e.Token="token",e.FileInfo="file_info"}(So||(So={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(Co||(Co={}));function jo(e,{publicKey:t,baseURL:r,source:o,integration:n,userAgent:a,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:i,signal:c,onProgress:l}){return Jr({check:c=>function(e,{publicKey:t,baseURL:r=Yr,signal:o,source:n,integration:a,userAgent:s,retryThrottledRequestMaxTimes:i=Qr,retryNetworkErrorMaxTimes:c=Zr}){return To((()=>ro({method:"GET",headers:{"X-UC-User-Agent":bo({publicKey:t,integration:a,userAgent:s})},url:ho(r,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:n}),signal:o}).then((({data:e,headers:t,request:r})=>{const o=Dr(JSON.parse(e));if("error"in o)throw new go(o.error.content,o.error.errorCode,r,o,t);return o}))),{retryThrottledRequestMaxTimes:i,retryNetworkErrorMaxTimes:c})}(e,{publicKey:t,baseURL:r,signal:c,source:o,integration:n,userAgent:a,retryThrottledRequestMaxTimes:s,retryNetworkErrorMaxTimes:i}).then((e=>e.isReady?e:(l&&l({isComputable:!0,value:1}),!1))),signal:c})}class Oo{uuid;name;size;isStored;isImage;mimeType;cdnUrl;s3Url;originalFilename;imageInfo;videoInfo;contentInfo;metadata;s3Bucket;defaultEffects=null;constructor(e,{baseCDN:t=Xr,fileName:r}={}){const{uuid:o,s3Bucket:n}=e,a=ho(t,`${o}/`),s=n?ho(`https://${n}.s3.amazonaws.com/`,`${o}/${e.filename}`):null;this.uuid=o,this.name=r||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=a,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=n||null,this.s3Url=s,function(e){return"defaultEffects"in e}(e)&&(this.defaultEffects=e.defaultEffects)}}var $o=window.WebSocket;class _o{events=Object.create({});emit(e,t){this.events[e]?.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}}class Uo{key;disconnectTime;ws=void 0;queue=[];isConnected=!1;subscribers=0;emmitter=new _o;disconnectTimeoutId=null;constructor(e,t=3e4){this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new $o(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,((e,t)=>"success"===e?{status:Co.Success,...t}:"progress"===e?{status:Co.Progress,...t}:{status:Co.Error,...t})(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){const r=JSON.stringify({event:e,data:t});this.ws?.send(r)}subscribe(e,t){this.subscribers+=1,this.connect();const r=`task-status-${e}`,o={event:"pusher:subscribe",data:{channel:r}};this.emmitter.on(r,t),this.isConnected?this.send(o.event,o.data):this.queue.push(o)}unsubscribe(e){this.subscribers-=1;const t=`task-status-${e}`,r={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(r.event,r.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}}let No=null;const Ro=e=>{if(!No){const t="undefined"==typeof window?0:3e4;No=new Uo(e,t)}return No};function Po({token:e,publicKey:t,baseURL:r,integration:o,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:s,onProgress:i,signal:c}){return Jr({check:c=>function(e,{publicKey:t,baseURL:r=Yr,signal:o,integration:n,userAgent:a,retryThrottledRequestMaxTimes:s=Qr,retryNetworkErrorMaxTimes:i=Zr}={}){return To((()=>ro({method:"GET",headers:t?{"X-UC-User-Agent":bo({publicKey:t,integration:n,userAgent:a})}:void 0,url:ho(r,"/from_url/status/",{jsonerrors:1,token:e}),signal:o}).then((({data:e,headers:t,request:r})=>{const o=Dr(JSON.parse(e));if("error"in o&&!(e=>"status"in e&&e.status===Co.Error)(o))throw new go(o.error.content,o.error.errorCode,r,o,t);return o}))),{retryNetworkErrorMaxTimes:i,retryThrottledRequestMaxTimes:s})}(e,{publicKey:t,baseURL:r,integration:o,userAgent:n,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:s,signal:c}).then((t=>{switch(t.status){case Co.Error:return new go(t.error,t.errorCode);case Co.Waiting:return!1;case Co.Unknown:return new go(`Token "${e}" was not found.`);case Co.Progress:return i&&("unknown"===t.total?i({isComputable:!1}):i({isComputable:!0,value:t.done/t.total})),!1;case Co.Success:return i&&i({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:c})}const Mo=(e,{publicKey:t,fileName:r,baseURL:o,baseCDN:n,checkForUrlDuplicates:a,saveUrlForRecurrentUploads:s,secureSignature:i,secureExpire:c,store:l,signal:u,onProgress:d,source:p,integration:m,userAgent:g,retryThrottledRequestMaxTimes:h,pusherKey:f=eo,metadata:y})=>Promise.resolve((e=>{Ro(e).connect()})(f)).then((()=>function(e,{publicKey:t,baseURL:r=Yr,store:o,fileName:n,checkForUrlDuplicates:a,saveUrlForRecurrentUploads:s,secureSignature:i,secureExpire:c,source:l="url",signal:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m=Qr,retryNetworkErrorMaxTimes:g=Zr,metadata:h}){return To((()=>ro({method:"POST",headers:{"X-UC-User-Agent":bo({publicKey:t,integration:d,userAgent:p})},url:ho(r,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:ko(o),filename:n,check_URL_duplicates:a?1:void 0,save_URL_duplicates:s?1:void 0,signature:i,expire:c,source:l,metadata:h}),signal:u}).then((({data:e,headers:t,request:r})=>{const o=Dr(JSON.parse(e));if("error"in o)throw new go(o.error.content,o.error.errorCode,r,o,t);return o}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}(e,{publicKey:t,fileName:r,baseURL:o,checkForUrlDuplicates:a,saveUrlForRecurrentUploads:s,secureSignature:i,secureExpire:c,store:l,signal:u,source:p,integration:m,userAgent:g,retryThrottledRequestMaxTimes:h,metadata:y}))).catch((e=>{const t=Ro(f);return t?.disconnect(),Promise.reject(e)})).then((e=>e.type===So.FileInfo?e:((e,{signal:t}={})=>{let r=null,o=null;const n=e.map((()=>new AbortController));return Hr(t,(()=>{n.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const a=(e=>()=>{o=e,n.forEach(((t,r)=>r!==e&&t.abort()))})(t);return Promise.resolve().then((()=>e({stopRace:a,signal:n[t].signal}))).then((e=>(a(),e))).catch((e=>(r=e,null)))}))).then((e=>{if(null===o)throw r;return e[o]}))})([({signal:r})=>Po({token:e.token,publicKey:t,baseURL:o,integration:m,userAgent:g,retryThrottledRequestMaxTimes:h,onProgress:d,signal:r}),({signal:t})=>(({token:e,pusherKey:t,signal:r,onProgress:o})=>new Promise(((n,a)=>{const s=Ro(t),i=s.onError(a),c=()=>{i(),s.unsubscribe(e)};Hr(r,(()=>{c(),a(new Gr("pusher cancelled"))})),s.subscribe(e,(e=>{switch(e.status){case Co.Progress:o&&("unknown"===e.total?o({isComputable:!1}):o({isComputable:!0,value:e.done/e.total}));break;case Co.Success:c(),o&&o({isComputable:!0,value:e.done/e.total}),n(e);break;case Co.Error:c(),a(new go(e.msg,e.error_code))}}))})))({token:e.token,pusherKey:f,signal:t,onProgress:d})],{signal:u}))).then((e=>{if(e instanceof go)throw e;return e})).then((e=>jo(e.uuid,{publicKey:t,baseURL:o,integration:m,userAgent:g,retryThrottledRequestMaxTimes:h,onProgress:d,signal:u}))).then((e=>new Oo(e,{baseCDN:n}))),zo=e=>"auto"===e?"auto":"temporary"!==e,Io=async e=>e.signatureProvider.map((async t=>t(e.pubKey).then((e=>({secureSignature:e.signature,secureExpire:String(e.expire)}))))).getOrThunk((()=>Promise.resolve({}))),Bo=async(e,t)=>{const r=await Io(t.credentials);if(!t.validate(e.type))return Promise.reject(new Error(Sr));const o=await((e,{publicKey:t,fileName:r,baseURL:o,secureSignature:n,secureExpire:a,store:s,contentType:i,signal:c,onProgress:l,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,baseCDN:h,metadata:f})=>function(e,{publicKey:t,fileName:r,contentType:o,baseURL:n=Yr,secureSignature:a,secureExpire:s,store:i,signal:c,onProgress:l,source:u="local",integration:d,userAgent:p,retryThrottledRequestMaxTimes:m=Qr,retryNetworkErrorMaxTimes:g=Zr,metadata:h}){return To((()=>ro({method:"POST",url:ho(n,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":bo({publicKey:t,integration:d,userAgent:p})},data:mo({file:{data:e,name:r||Eo(e),contentType:o||Ao(e)},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:ko(i),signature:a,expire:s,source:u,metadata:h}),signal:c,onProgress:l}).then((({data:e,headers:t,request:r})=>{const o=Dr(JSON.parse(e));if("error"in o)throw new go(o.error.content,o.error.errorCode,r,o,t);return o}))),{retryNetworkErrorMaxTimes:g,retryThrottledRequestMaxTimes:m})}(e,{publicKey:t,fileName:r,contentType:i,baseURL:o,secureSignature:n,secureExpire:a,store:s,signal:c,onProgress:l,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,metadata:f}).then((({file:e})=>jo(e,{publicKey:t,baseURL:o,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:g,onProgress:l,signal:c}))).then((e=>new Oo(e,{baseCDN:h}))))(e,{...t.baseUrl.map((e=>({baseURL:e}))).getOr({}),baseCDN:t.cdnUrl,publicKey:t.credentials.pubKey,store:zo(t.storeType),...r,onProgress:e=>{e.isComputable&&t.progress(e.value)}});return t.validate(o.mimeType)?{url:o.cdnUrl,isImage:o.isImage}:Promise.reject(new Error(Sr))},Lo=e=>new Promise(((t,r)=>{const o=()=>{a(),t(e)},n=[Dt(e,"load",o),Dt(e,"error",(()=>{a(),r(new Error("Unable to load data from image: "+e.dom.src))}))],a=()=>xe(n,(e=>e.unbind()));e.dom.complete&&o()})),qo=(e,t)=>{var r;const o=e.dom.create("figure",{class:"image"});o.contentEditable="false",null===(r=t.parentNode)||void 0===r||r.insertBefore(o,t),o.appendChild(t);const n=e.dom.create("figcaption");n.contentEditable="true",n.textContent=""!==t.alt?t.alt:tinymce.i18n.translate("Caption"),o.appendChild(n),((e,t)=>{const r=((e,t)=>{var r;const o=e.dom,n=Ue(e.schema.getTextBlockElements(),((t,r)=>!e.schema.isValidChild(r,"figure"))),a=o.getParent(t.parentNode,(e=>((e,t)=>Re(e,t)&&void 0!==e[t]&&null!==e[t])(n,e.nodeName)),e.getBody());return a&&null!==(r=o.split(a,t))&&void 0!==r?r:t})(e,t);e.selection.select(r)})(e,o)},Do=(e,t)=>ge.from(e.dom.select("img",t)[0]),Ko=e=>{const t=e.attr("class");return oe(t)&&/\bimage\b/.test(t)},Fo=e=>t=>{let r=t.length;const o=t=>{t.attr("contenteditable",e?"true":null)};for(;r--;){const n=t[r];Ko(n)&&(n.attr("contenteditable",e?"false":null),xe(n.getAll("figcaption"),o))}},Vo=e=>"IMG"===e.nodeName,Wo=(e,t)=>Xe(t,At(e)),Ho=e=>"FIGURE"===e.nodeName,Go=async(e,t)=>{Wt(t,"src",e),Wt(t,"data-mce-src",e),await Lo(t)},Jo=e=>{const t=we(e.split(","),Ye);return we(t,(e=>{const[t,r]=e.split(/\s+/);return{url:t,descriptor:J(r)?r:""}}))},Xo=e=>{const t=e.split("/"),r=t.indexOf("-");if(-1!==r){const e=t.slice(0,r).join("/"),o=t.slice(r);let n="";const a=[];let s=[];for(let e=0;e<o.length;e++)if("-"===o[e]&&e<o.length-1){for(n=o[e+1],s=[],e+=2;e<o.length;e++){if("-"===o[e]){e--;break}""!==o[e]&&s.push(o[e])}a.push({name:n,args:s})}return{prefix:e,operations:a}}return{prefix:e,operations:[]}},Yo=e=>"preview"===e.name&&0===e.args.length,Qo=(e,t)=>(e=>{const t=(e=>{const t=Te(e.operations,(r=Yo,e=>!r(e)));var r;return be(t,(({name:e})=>(e=>ye(["resize","smart_resize","scale_crop","preview"],e))(e)))?{...e,operations:t}:{...e,operations:[{name:"preview",args:[]},...t]}})(e),r=we(t.operations,(e=>["-",e.name,...e.args].join("/")));return[t.prefix.replace(/\/$/,""),...r,""].join("/")})(t(Xo(e))),Zo=(e,t)=>be(e.operations,(e=>e.name===t)),en=(e,t)=>({...e,operations:Te(e.operations,(e=>!t(e.name,e.args)))}),tn=(e,t)=>Qo(e,(e=>en(e,(e=>e===t)))),rn=(e,t)=>Qo(e,(e=>en(e,t))),on=(e,t,r)=>Qo(e,(e=>((e,t,r)=>{if(Zo(e,t)){const o=ke(e.operations,(e=>{if(e.name===t){const o=r(e.args);return o.length>0?[{name:t,args:o}]:[]}return[e]}));return{...e,operations:o}}return{...e,operations:e.operations.concat({name:t,args:r([])})}})(e,t,r))),nn=(e,t,r)=>Qo(e,(e=>((e,t,r)=>{let o=!1;const n=ke(e.operations,(e=>{if(t(e.name,e.args)){o=!0;const t=we(r(e.args),(e=>({name:e.name,args:e.args})));return Te(t,(e=>e.args.length>0))}return[e]}));return o?{...e,operations:n}:{...e,operations:e.operations.concat(r([]))}})(e,t,r))),an=(e,t)=>((e,t)=>Ee(e.operations,(e=>e.name===t)))(Xo(e),t),sn=(e,t)=>((e,t)=>an(e,t).bind((e=>ge.from(e.args[0]))))(e,t).bind(Ze),cn=(e,t,r)=>((e,t,r)=>on(e,t,(e=>[r])))(e,t,String(r)),ln=(e,t,r)=>{const o=Te(e,(e=>e<r));return Ve(o.length>0,we(o,(e=>`${((e,t)=>on(e,"resize",(e=>[`${t}x`])))(t,e)} ${e}w`)).concat(`${t} ${r}w`).join(","))},un=e=>`(min-width: ${e}px) ${e}px, 100vw`,dn=(e,t,r,o,n)=>{ln(kt(e),r,o).each((r=>{Wt(t,"srcset",r),Wt(t,"sizes",un(o)),gn(e,t,o,n)}))},pn=(e,t)=>{Jt(e,"srcset").each((r=>{const o=Jo(r),n=we(o,(e=>({url:t(e.url),descriptor:e.descriptor})));Wt(e,"srcset",(e=>Ye(we(e,(e=>`${e.url} ${e.descriptor}`)).join(",")))(n))}))},mn=(e,t)=>{Wt(e,"sizes",`${t}px`)},gn=(e,t,r,o)=>{e.dom.setStyle(t.dom,"aspect-ratio",`${r} / ${o}`)},hn=(e,t,r=t.dom.naturalWidth,o=t.dom.naturalHeight)=>{e.dom.setStyle(t.dom,"width",`min(${r}px, 100%)`),dn(e,t,t.dom.src,r,o)},fn=(e,t,r,o)=>{(e=>!Xt(e,"sizes")||Jt(e,"sizes").exists((e=>Je(e,"(min-width:"))))(t)?(gn(e,t,t.dom.naturalWidth,t.dom.naturalHeight),Wt(t,"sizes",un(t.dom.width))):(gn(e,t,r,o),mn(t,r)),ln(kt(e),t.dom.src,r).fold((()=>Wt(t,"srcset","")),(e=>Wt(t,"srcset",e)))},yn=qe("data-mce-uc-srcset").replaceAll("_","-"),bn=(e,t,r,o)=>e.replaceAll(`${t}/-/resize/`,`${r}-/resize/`).replaceAll(t,o),vn=e=>{const t=e.options.isSet("images_upload_handler"),r=e.options.isSet("images_upload_url");t||r||(e.options.set("images_upload_handler",(async(t,r)=>{const{url:o}=await Bo(xn(t.blob(),t.filename()),{baseUrl:Et(e),cdnUrl:At(e),storeType:Tt(e),credentials:xt(e),progress:e=>r(Math.round(100*e)),validate:t=>kr(t,e)}),n=`${o}-/preview/`;return a=e.undoManager.data,s=e=>Je(e,t.blobUri()),i=e=>((e,t,r,o)=>e.replaceAll(`src="${t}"`,`src="${o}"`).replaceAll(`data-mce-src="${t}"`,`data-mce-src="${o}"`).replace(new RegExp(`${yn}="([^"]+)"`,"g"),((e,n)=>Je(n,t)?`srcset="${bn(n,t,r,o)}"`:e)))(e,t.blobUri(),o,n),xe(a,(e=>{s((e=>"complete"===e.type?e.content:e.fragments.join(""))(e))&&((e,t)=>{"complete"===e.type?e.content=t(e.content):e.fragments=we(e.fragments,t)})(e,i)})),xe(br(Ot(e.getBody()),"img"),(e=>{Jt(e,yn).each((r=>{Je(r,t.blobUri())&&(Wt(e,yn,bn(r,t.blobUri(),o,n)),(e=>{Jt(e,yn).each((t=>{Wt(e,"srcset",t),Yt(e,yn)}))})(e))}))})),n;var a,s,i})),e.options.set("automatic_uploads",!0)),e.on("BeforeSetContent",(t=>{var r;t.paste&&!t.uploadcareProcessed&&(r=t.content,Je(r,'src="blob:'))&&(t.preventDefault(),t.stopImmediatePropagation(),(async(e,t)=>{const r=Ot((new DOMParser).parseFromString(t,"text/html").body),o=ke(br(r,"img"),(e=>Xe(e.dom.src,"blob:")&&!Xt(e,"srcset")?[e]:[])),n=await Promise.all(we(o,(e=>{return(t=e.dom.src,new Promise(((e,r)=>{const o=new Image;o.src=t,o.addEventListener("load",(()=>{e({width:o.naturalWidth,height:o.naturalHeight})})),o.addEventListener("error",(()=>{r(new Error("Failed to load image"))}))}))).then((({width:t,height:r})=>({img:e,width:t,height:r})));var t})));return xe(n,(({img:t,width:r,height:o})=>{hn(e,t,r,o),(e=>{Jt(e,"srcset").each((t=>{Wt(e,yn,t),Yt(e,"srcset")}))})(t)})),r.dom.innerHTML})(e,t.content).then((t=>{e.insertContent(t,{paste:!0,uploadcareProcessed:!0})}),zr))}),!0),e.on("PreInit",(()=>{e.serializer.addAttributeFilter(yn,(e=>{xe(e,(e=>e.attr(yn,null)))}))}))},wn=e=>e.isImage?`${e.url}-/preview/`:e.url,xn=(e,t)=>new window.File([e],t,{type:e.type}),Tn=async(e,t)=>await Bo(t,{baseUrl:Et(e),cdnUrl:At(e),storeType:Tt(e),credentials:xt(e),progress:se,validate:t=>kr(t,e)}).then(wn),An=async(e,t)=>{if(Xe(t,"blob:")){const r=e.editorUpload.blobCache.getByUri(t);return re(r)?Promise.reject(new Error("Blob not found in local cache")):Tn(e,xn(r.blob(),r.filename()))}return await(async(e,t)=>{const r=await Io(t.credentials),o=await Mo(e,{...t.baseUrl.map((e=>({baseURL:e}))).getOr({}),baseCDN:t.cdnUrl,publicKey:t.credentials.pubKey,store:zo(t.storeType),...r,onProgress:e=>{e.isComputable&&t.progress(e.value)}});return t.validate(o.mimeType)?{url:o.cdnUrl,isImage:o.isImage}:Promise.reject(new Error(Sr))})(t,{baseUrl:Et(e),cdnUrl:At(e),storeType:Tt(e),credentials:xt(e),progress:se,validate:t=>kr(t,e)}).then(wn)},En={colorAdjustmentDebounceTime:600},kn=(e,t,r,o=[])=>{class n extends e.HTMLElement{constructor(){super(),this.spec=r(),this.spec.setup(this.attachShadow({mode:"open"}));for(const e in this.spec.properties){const t=this.spec.properties[e].get.bind(this),r=this.spec.properties[e].set.bind(this);Object.defineProperty(this,e,{get(){return t(this)},set(e){r(this,e)}})}}connectedCallback(){this.spec.connectedCallback&&this.spec.connectedCallback(this)}disconnectedCallback(){this.spec.disconnectedCallback&&this.spec.disconnectedCallback(this)}attributeChangedCallback(e,t,r){this.spec.attributeChangedCallback&&this.spec.attributeChangedCallback({element:this,name:e,oldValue:t,newValue:r})}}n.observedAttributes=o,re(e.customElements.get(t))&&e.customElements.define(t,n)},Sn=(e,t,r=se)=>{const o=jt("div"),n=["input","NodeChange","ResizeEditor","ResizeWindow","ResizeContent","drop"].join(" "),a=()=>{ge.from(e.inline?e.getBody():e.getBody().parentElement).map(Ot).each((r=>{if(!((e,t)=>{const r=e.dom,o=t.dom;return r!==o&&r.contains(o)})(r,t))return void s();const n=e.dom.getPos(t.dom,e.getBody()),a=(i=t,pr.get(i));var i;const c=(e=>dr.get(e))(t);ar(o,{left:`${n.x}px`,top:`${n.y}px`,width:`${a}px`,height:`${c}px`,position:"absolute","pointer-events":"none"}),yr(o,"tox-uc-image-overlay"),Wt(o,"data-mce-bogus","all")}))},s=()=>{e.off(n,a),e.off("remove",s),Zt(o),r()};return(()=>{const t=Ot(e.getBody());Ft(t,o),e.on(n,a,!0),a()})(),e.on("remove",s),{element:o,destroy:s}},Cn="tox-uc-loading-spinner-wrapper",jn="tox-uc-loading-spinner",On=e=>{const t=jt("div");return yr(t,"tox-uc-loading-element"),e.semiTransparentBackground&&(e=>{yr(e,"tox-uc-loading-background")})(t),e.spinner&&(e=>{yr(e,Cn);const t=jt("div");yr(t,jn),Ft(e,t)})(t),e.whiteBackground&&(e=>{nr(e,"background-color","white")})(t),e.zIndex.each((e=>((e,t)=>{ar(e,{position:"absolute","z-index":t})})(t,e))),t},$n=(e,t,r)=>{kn(e.getWin(),t,(()=>{let t=!1;return{setup:t=>{const o=document.createElement("style");o.textContent=`\n        @keyframes tox-rotation {\n          0% {\n            transform: rotate(0deg);\n          }\n          100% {\n            transform: rotate(360deg);\n          }\n        }\n\n        .${Cn} {\n          display: var(--${Cn}-display-none);\n\n          position: var(--${Cn}-position);\n          top: var(--${Cn}-top);\n          left: var(--${Cn}-left);\n\n          width: var(--${Cn}-width);\n          height: var(--${Cn}-height);\n          justify-content: var(--${Cn}-justify-content);\n          align-items: var(--${Cn}-align-items);\n        }\n\n        .${jn} {\n          aspect-ratio: var(--${jn}-aspect-ratio);\n          width: var(--${jn}-width);\n          border-radius: var(--${jn}-border-radius);\n          border: var(--${jn}-border);\n          border-bottom-color: var(--${jn}-border-bottom-color);\n          animation: var(--${jn}-animation);\n        }\n\n        .${r}--content {\n          cursor: var(--${r}--content-cursor);\n          color: var(--${r}--content-color);\n          background-color: var(--${r}--content-background-color);\n          border: var(--${r}--content-border);\n          font-family: var(--${r}--content-font-family);\n          height: var(--${r}--content-height);\n          width: var(--${r}--content-width);\n          display: var(--${r}--content-display);\n          align-items: var(--${r}--content-align-items);\n          justify-content: var(--${r}--content-justify-content);\n          gap: var(--${r}--content-gap);\n\n          svg {\n            fill: var(--${r}--icon-fill)\n          }\n        }\n      `,t.appendChild(o),t.append(((e,t)=>{const r=`\n  ${Ne(e.ui.registry.getAll().icons,"add-file").getOr("unknown")}\n  <span>${e.translate("Drop files here")}</span>\n  `.trim(),o=document.createElement("span");return o.classList.add(`${t}--content`),o.innerHTML=r,o})(e,r));const n=On({semiTransparentBackground:!1,whiteBackground:!0,spinner:!0,zIndex:ge.none()});t.append(n.dom)},properties:{loading:{get:()=>t,set:(e,r)=>{var o,n;t=r,e.shadowRoot&&(o=Ot(e.shadowRoot),n=".tox-uc-loading-spinner-wrapper",((e,t)=>{const r=void 0===t?document:t.dom;return Ut(r)?ge.none():ge.from(r.querySelector(e)).map(Ot)})(n,o)).each((e=>{nr(e,"display",r?`var(--${Cn}-display)`:`var(--${Cn}-display-none)`)}))}}}}}))},_n="tox-uploadcare-placeholder",Un="tiny-uploadcare-placeholder",Nn=e=>e.tagName.toLocaleLowerCase()===Un&&"loading"in e,Rn=e=>{e.on("PreInit",(()=>{(e=>{e.schema.addCustomElements({[Un]:{extends:"span"}})})(e),$n(e,Un,_n),(e=>{e.parser.addNodeFilter(Un,(e=>{e.forEach((e=>{e.attr("contenteditable","false")}))})),e.serializer.addNodeFilter(Un,(e=>{e.forEach((e=>{e.remove()}))}))})(e),(e=>{e.serializer.addNodeFilter(Un,(e=>{for(let t=0;t<e.length;t++)e[t].remove()}))})(e),(e=>{const t=((e,t,r,o)=>Bt(e,t,r,o,!0))(Ot(e.getBody()),"load",qt,(t=>{t.raw.target&&Vo(t.raw.target)&&e.nodeChanged()}));e.on("remove",(()=>{t.unbind()}))})(e)})),e.on("ResolveName",(e=>{e.name===Un&&(e.name="placeholder")})),e.on("drop",(({target:e})=>{Nn(e)&&setTimeout((()=>{e.remove()}),0)}))},Pn=async(e,t,r)=>{t.dom.loading=!0,await r().finally((()=>t.dom.loading=!1))},Mn=(e,t)=>{((e,t)=>{t.get().each((r=>{e.getBody().contains(r)||t.clear()}))})(e,t),t.get().each((t=>{e.focus(),e.selection.select(t),e.nodeChanged()}))},zn=e=>t=>((e,t)=>Qo(e,(e=>((e,t)=>Zo(e,t)?{...e,operations:Te(e.operations,(e=>e.name!==t))}:{...e,operations:e.operations.concat([{name:t,args:[]}])})(e,t))))(t,e),In=e=>t=>rn(t,e),Bn=(e,t)=>r=>on(r,e,t),Ln={brightness:{zero:0,min:-100,max:100,keypoints:2},exposure:{zero:0,min:-500,max:500,keypoints:2},gamma:{zero:100,min:0,max:1e3,keypoints:2},contrast:{zero:0,min:-100,max:500,keypoints:2},saturation:{zero:0,min:-100,max:500,keypoints:1},vibrance:{zero:0,min:-100,max:500,keypoints:1},warmth:{zero:0,min:-100,max:100,keypoints:1},enhance:{zero:0,min:0,max:100,keypoints:1}},qn=e=>Ne(Ln,e),Dn=(e,t,r)=>qn(t).map((o=>"enhance"===t&&50===r?on(e,t,ie([])):r===o.zero?tn(e,t):cn(e,t,Be(Math.floor(r),o.min,o.max)))).getOr(e),Kn=zn("invert"),Fn=zn("grayscale"),Vn=e=>{const t=(e=>/\d+:\d+/.test(e))(e)?":":"x",[r,o]=we(e.split(t),(e=>Ze(e)));return{width:r,height:o}},Wn=e=>{const{width:t,height:r}=Vn(e);return n=r,a=(e,t)=>e/t,(o=t).isSome()&&n.isSome()?ge.some(a(o.getOrDie(),n.getOrDie())):ge.none();var o,n,a},Hn=(e,t)=>{if(Je(e,`-/crop/${t}/`))return!0;const r=e.substring(e.indexOf("-/scale_crop/")+13),o=(e=>{const t=[];for(let r=0;r<e.length;r++){const o=e[r];if(!o.isSome())return ge.none();t.push(o.getOrDie())}return ge.some(t)})(we(r.substring(0,r.indexOf("/")).split("x"),(e=>Ze(e))));return o.map((e=>{if(e.length<2)return!1;const r=e[0]/e[1],o=e[1]/e[0];switch(t){case"1:1":return Math.round(100*r)/100==1;case"3:4":return Math.round(100*r)/100==.75;case"4:3":return Math.round(100*o)/100==.75;default:return!1}})).getOr(!1)},Gn=["smart","smart_faces_objects_points","smart_faces_objects","smart_faces_points","smart_objects_faces_points","smart_objects_faces","smart_objects_points","smart_points","smart_objects","smart_faces"],Jn=e=>/\d+x\d+/.test(e),Xn=e=>"scale_crop"===e,Yn=(e,t)=>!(t.length<1)&&(Xn(e)||"crop"===e&&("face"===t[0]||"image"===t[0])),Qn=(e,t)=>!(t.length<1)&&"crop"===e&&new RegExp(/\d:\d/).test(t[0]),Zn=(e,t)=>Yn(e,t)||Qn(e,t),ea=(e,t)=>Qn(e,t)||Xn(e),ta=In(Yn),ra=In(ea),oa=zn("flip"),na=zn("mirror"),aa=Bn("rotate",(e=>0===e.length||"0"===e[0]?["270"]:"270"===e[0]?["180"]:"180"===e[0]?["90"]:[])),sa=Bn("rotate",(e=>0===e.length||"0"===e[0]?["90"]:"90"===e[0]?["180"]:"180"===e[0]?["270"]:[])),ia=e=>{const t=e.selection.getNode();return Ve(Vo(t)&&!Nn(t),t)},ca=e=>{const t=e.dom.getParent(e.selection.getNode(),Ho);return t&&Ho(t)?ge.some(t):ge.none()},la=e=>ia(e).orThunk((()=>ca(e).bind((t=>Do(e,t))))),ua=e=>{const t=e.selection.getNode();return Nn(t)?ge.some(Ot(t)):ge.none()},da=(e,t,r)=>{e.undoManager.transact((()=>{ia(e).fold((()=>ca(e).each((e=>r(e)))),(e=>t(e)))}))},pa=(e,t,r)=>ia(e).fold((()=>ca(e).map((e=>r(e)))),(e=>ge.from(t(e)))),ma="data-mce-original-dimensions",ga=e=>{const t=e=>Xt(Ot(e),ma)?Gt(Ot(e),ma):`${e.width}x${e.height}`;return pa(e,t,(r=>Do(e,r).map(t).getOr("0x0"))).getOr("")},ha=["src","alt"],fa=(e,t)=>Jt(e,t).fold((()=>{const r="width"===t?e.dom.clientWidth:e.dom.clientHeight;return cr(e,t).getOr(`${r}px`)}),(e=>`${e}px`)),ya=e=>/^[\d.]+px$/.test(e)?(e=>{const t=parseFloat(e);return isNaN(t)?ge.none():ge.some(t)})(e):ge.none(),ba=(e,t,r)=>{const o=fa(t,"width"),n=fa(t,"height"),a=(e=>/^min\(([\d.]+)px,\s*100%\)$/.test(e))(o),s=a?`min(${r.dom.naturalWidth}px, 100%)`:n,i=o;Yt(r,"width"),Yt(r,"height"),nr(r,"width",s),a?lr(r,"height"):nr(r,"height",i);const c=ya(s).getOr(r.dom.naturalWidth),l=ya(i).getOr(r.dom.naturalHeight);fn(e,r,c,l)},va=e=>pa(e,(e=>Xt(Ot(e),"alt")&&""===e.alt),(t=>((e,t)=>Do(e,t).exists((e=>Xt(Ot(e),"alt")&&""===e.alt)))(e,t))).getOr(!1),wa=e=>{Jt(e,"title").each((t=>{Yt(e,"title"),Xt(e,"alt")||Wt(e,"alt",t)}))},xa=(e,t,r,o={shouldUpdateDimensions:!1})=>{const n=r.naturalWidth,a=Ot(r),s=r.src;return wa(a),((e,t,r)=>{const o=Sn(e,t);return Ft(o.element,On({semiTransparentBackground:!0,whiteBackground:!1,spinner:!0,zIndex:ge.none()})),r().finally(o.destroy)})(e,a,(async()=>{const r=await(async(e,t)=>Wo(e,t)?t:An(e,t))(e,s),i=t(r),c=(e=>{const t=jt("img"),r=Ue(Qt(e),((e,t)=>!ye(["data-mce-selected","src","data-mce-src","srcset"],t)));return Ht(t,r),t})(a);await Go(i,c),o.shouldUpdateDimensions&&(e=>{Xt(e,"width")&&Wt(e,"width",e.dom.naturalWidth),Xt(e,"height")&&Wt(e,"height",e.dom.naturalHeight)})(c),o.imgUpdate?o.imgUpdate(e,a,c):Jt(a,"srcset").filter((t=>!((e,t)=>be(Jo(t),(t=>!Wo(e,t.url))))(e,t))).fold((()=>dn(e,c,i,n,c.dom.naturalHeight)),(e=>{Wt(c,"srcset",e),pn(c,t)})),e.undoManager.transact((()=>{((e,t,r)=>{Yt(r,"width"),Yt(r,"height");const o=Ue(Qt(t),((e,t)=>!ye(["data-mce-selected","src","data-mce-src"],t)));Ht(r,o),e.dom.setAttrib(r.dom,"src",t.dom.src),t.dom.remove()})(e,c,a)})),await er(a)})).catch(Ir(e))},Ta=(e,t={shouldUpdateDimensions:!1})=>r=>((e,t,r={shouldUpdateDimensions:!1})=>{la(e).each((o=>{xa(e,t,o,r)}))})(r,e,t),Aa=(e,t)=>async r=>{try{await er(t),wa(t);const o=((e,t)=>Ot(e.dom.cloneNode(!1)))(t);if(await er(o),!Wo(r,o.dom.src)){const e=await An(r,o.dom.src);await Go(e,o)}Xt(o,"srcset")||dn(r,o,o.dom.src,o.dom.naturalWidth,o.dom.naturalHeight),await e(o),await er(o),Xt(o,"srcset")||dn(r,o,o.dom.src,o.dom.naturalWidth,o.dom.naturalHeight),r.undoManager.transact((()=>((e,t)=>{_e(Qt(e),((e,r)=>{Wt(t,r,e)})),xe(Oe(Qt(t)),(r=>{Xt(e,r)||Yt(t,r)}))})(o,t))),await er(t)}catch(e){e instanceof Error&&Ir(r)(e)}},Ea=Ta(oa),ka=Ta(na),Sa=Ta(Kn),Ca=Ta(Fn),ja=(e,t)=>Ta((e=>((e,t)=>on(e,"border_radius",(e=>{switch(t){case"Rounded":return["50"];case"Circle":return["50p"];default:return[]}})))(e,t)))(e),Oa=Ta(aa,{imgUpdate:ba}),$a=Ta(sa,{imgUpdate:ba}),_a=(e,t,r,o)=>Aa((o=>((e,t,r,o)=>(gn(e,t,r,o),mn(t,r),((e,t,r,o)=>{cr(t,"width").fold((()=>Wt(t,"width",r)),(()=>e.dom.setStyle(t.dom,"width",`${r}px`))),cr(t,"height").fold((()=>Wt(t,"height",o)),(()=>e.dom.setStyle(t.dom,"height",`${o}px`)))})(e,t,r,o),Promise.resolve()))(e,o,t,r)),o)(e),Ua=(e,t,r,o)=>Ta((e=>((e,t,r,o)=>nn(e,Yn,(e=>{let n=[];return(e=>{const t=Ae(e,((e,t)=>{return{smartCropArg:e.smartCropArg||(r=t,ye(Gn,r)),smartCropDimensionsArg:e.smartCropDimensionsArg||Jn(t)};var r}),{smartCropArg:!1,smartCropDimensionsArg:!1});return t.smartCropArg&&t.smartCropDimensionsArg})(e)&&o.isSome()&&Ee(e,Jn).each((e=>{o.each((t=>{((e,t)=>{const r=Wn(e),o=Wn(t);if(r.exists((e=>o.exists((t=>e===t)))))return ge.none();{const e=Ae(["4:3","3:4","1:1"],((e,t)=>{const{width:r,height:n}=Vn(t),a=Fe(o,r,n,((e,t,r)=>Math.abs(e-t/r)));return e.isNone()||e.exists((e=>a.exists((t=>t<Math.abs(e.diff)))))?a.map((e=>({diff:e,ratio:t}))):e}),ge.none());return e.map((e=>e.ratio))}})(t,e).each((e=>{n=[{name:"crop",args:[e]}]}))}))})),[{name:"crop",args:[t,r]}].concat(n)})))(e,t,r,o)))(e),Na=(e,t,r,o)=>Ta((e=>((e,t,r,o)=>nn(e,Zn,(e=>o.fold((()=>[{name:"scale_crop",args:[r,t]}]),(e=>((e,t)=>{const{width:r,height:o}=Vn(e),{width:n,height:a}=Vn(t);var s,i,c,l,u;return(i=o,c=n,l=a,u=(e,t,r,o)=>((e,t,r,o)=>{const n=e/r*o;if(n<=t)return[e,Math.round(n)];const a=t/o*r;return a<=e?[Math.round(a),t]:[0,0]})(e,t,r,o),(s=r).isSome()&&i.isSome()&&c.isSome()&&l.isSome()?ge.some(u(s.getOrDie(),i.getOrDie(),c.getOrDie(),l.getOrDie())):ge.none()).map((([e,t])=>`${e}x${t}`))})(r,e).fold((()=>[]),(e=>[{name:"scale_crop",args:[e,t]}])))))))(e,t,r,o)))(e),Ra=(e,t)=>{e.undoManager.transact((()=>{const r=e.selection.getNode();if(Nn(r)&&Vo(t)){const o=qe("mce");Jt(Ot(r),"style").each((e=>{t.setAttribute("style",e)})),t.setAttribute("data-mce-id",o);const n=new window.Range;n.setStartAfter(r),n.setEndAfter(r),e.selection.setRng(n),r.remove(),e.insertContent(t.outerHTML),je(e.dom.select(`[data-mce-id="${o}"]`)).each((t=>{t.removeAttribute("data-mce-id"),e.selection.select(t)}))}else{const r=qe("mce");t.setAttribute("data-mce-id",r),e.insertContent(t.outerHTML),je(e.dom.select(`[data-mce-id="${r}"]`)).each((t=>{t.removeAttribute("data-mce-id"),e.selection.select(t)}))}}))},Pa=e=>Ra(e,(e=>e.dom.create(Un,{class:`${_n} mce-placeholder`}))(e)),Ma=async(e,t,r,o)=>{const n=jt("img");Wt(n,"src",o),await er(n),hn(e,n);const a=Ot(e.selection.getNode());var s;s=t,a.dom===s.dom?(Mn(e,r),Ra(e,n.dom)):e.undoManager.transact((()=>{Kt(t,n),Zt(t)}))},za=(e,t,r,o)=>(Mn(e,r),((e,t)=>{Ta((e=>((e,t)=>((e,t)=>{const r=Xo(t);return Qo(e,(e=>({...e,prefix:r.prefix})))})(e,t))(e,t)),{imgUpdate:(e,t,r)=>fn(e,r,r.dom.naturalWidth,r.dom.naturalHeight)})(e)})(e,o),Promise.resolve()),Ia=(e,t)=>t(pa(e,(e=>e.src),(t=>Do(e,t).map((e=>e.src)).getOr(""))).getOr("")),Ba=e=>{e.ui.registry.addButton("uploadcare-flip",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:()=>{e.focus(),Ea(e)}}),e.ui.registry.addButton("uploadcare-mirror",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:()=>{e.focus(),ka(e)}}),e.ui.registry.addButton("uploadcare-rotate-counter",{tooltip:"Rotate left",icon:"rotate-left",onAction:()=>{e.focus(),$a(e)}}),e.ui.registry.addButton("uploadcare-rotate",{tooltip:"Rotate right",icon:"rotate-right",onAction:()=>{e.focus(),Oa(e)}}),e.ui.registry.addMenuButton("uploadcare-crop",{text:$r,icon:"horizontal-rule",onSetup:t=>(Ia(e,(e=>Je(e,"-/crop/image/175px175p")))?(t.setText(_r),t.setIcon("image")):Ia(e,(e=>Je(e,"-/crop/face/175px175p")))?(t.setText(Ur),t.setIcon("emoji")):Ia(e,(e=>Je(e,"-/scale_crop/")))&&(t.setText(Nr),t.setIcon("ai-prompt")),se),fetch:t=>{t([{type:"menuitem",text:$r,icon:"horizontal-rule",onAction:()=>{(e=>{Ta((e=>ta(e)),{shouldUpdateDimensions:!0})(e)})(e),e.focus()}},{type:"menuitem",text:_r,icon:"image",onAction:()=>{Ua(e,"image","175px175p",ge.some(ga(e))),e.focus()}},{type:"menuitem",text:Ur,icon:"emoji",onAction:()=>{Ua(e,"face","175px175p",ge.some(ga(e))),e.focus()}},{type:"menuitem",text:Nr,icon:"ai-prompt",onAction:()=>{Na(e,"smart",ga(e),ge.none()),e.focus()}}])}});const t=t=>{Ia(e,(e=>Je(e,"-/scale_crop/")))?Na(e,"smart",ga(e),t):t.fold((()=>(e=>Ta((e=>ra(e)),{shouldUpdateDimensions:!0})(e))(e)),(t=>((e,t)=>Ta((e=>((e,t)=>nn(e,ea,(e=>[{name:"crop",args:[t]}])))(e,t)),{shouldUpdateDimensions:!0})(e))(e,t)))};e.ui.registry.addToggleButton("uploadcare-ratio-original",{tooltip:"Original ratio",text:"Original",onAction:()=>{t(ge.none())},onSetup:t=>(t.setActive(Ia(e,(e=>!be(["4:3","3:4","1:1"],(t=>Hn(e,t)))))),se)}),e.ui.registry.addToggleButton("uploadcare-ratio-1-1",{tooltip:e.translate([Rr,"1:1"]),icon:"unselected",text:"1:1",onAction:()=>{t(ge.some("1:1"))},onSetup:t=>(t.setActive(Ia(e,(e=>Hn(e,"1:1")))),se)}),e.ui.registry.addToggleButton("uploadcare-ratio-4-3",{tooltip:e.translate([Rr,"4:3"]),icon:"unselected",text:"4:3",onAction:()=>{t(ge.some("4:3"))},onSetup:t=>(t.setActive(Ia(e,(e=>Hn(e,"4:3")))),se)}),e.ui.registry.addToggleButton("uploadcare-ratio-3-4",{tooltip:e.translate([Rr,"3:4"]),icon:"unselected",text:"3:4",onAction:()=>{t(ge.some("3:4"))},onSetup:t=>(t.setActive(Ia(e,(e=>Hn(e,"3:4")))),se)}),e.ui.registry.addToggleButton("uploadcare-border-none",{tooltip:"None",icon:"unselected",onAction:()=>{ja(e,"None")},onSetup:t=>(t.setActive(Ia(e,(e=>!Je(e,"-/border_radius/")))),se)}),e.ui.registry.addToggleButton("uploadcare-border-rounded",{tooltip:"Rounded",icon:"rounded",onAction:()=>{ja(e,"Rounded")},onSetup:t=>(t.setActive(Ia(e,(e=>Je(e,"-/border_radius/50/")))),se)}),e.ui.registry.addToggleButton("uploadcare-border-circle",{tooltip:"Circle",icon:"circle",onAction:()=>{ja(e,"Circle")},onSetup:t=>(t.setActive(Ia(e,(e=>Je(e,"-/border_radius/50p/")))),se)}),e.ui.registry.addToggleButton("uploadcare-enhance-auto-enhance",{tooltip:Pr,icon:"typography",text:Pr,onAction:()=>{((e,t=50)=>{Ta((e=>Dn(e,"enhance",t)))(e)})(e)},onSetup:t=>(t.setActive(Ia(e,(e=>Je(e,"-/enhance/")))),se)})},La=(e,t)=>{e.hasPlugin("quickbars")?(e.addCommand("QuickbarInsertImage",(()=>Pa(e))),e.on("PreInit",(()=>{e.ui.registry.addContextToolbar("imageselection",{predicate:pe,items:[],position:"node"})}))):e.ui.registry.addButton("uploadcare",{icon:"image",tooltip:"Insert image",onAction:()=>{e.focus(),Pa(e)}}),e.ui.registry.addToggleButton("uploadcare-caption",{icon:"caption",tooltip:"Caption",onSetup:t=>{const r=()=>{t.setActive(ca(e).isSome())};return e.on("NodeChange",r),r(),()=>{e.off("NodeChange",r)}},onAction:()=>{e.focus(),(e=>{da(e,(t=>qo(e,t)),(t=>((e,t)=>{Do(e,t).each((r=>{const o=e.dom.create((e=>e.options.get("forced_root_block"))(e));e.dom.insertAfter(o,t),o.appendChild(r),t.remove(),e.selection.select(r)}))})(e,t)))})(e)}});const r=(r,o)=>{e.ui.registry.addButton(r,{icon:"folder",tooltip:"Upload from device",onAction:()=>{(e=>new Promise((t=>{let r=!1;const o=document.createElement("input");o.type="file",o.accept=Er(e).join(","),o.style.position="fixed",o.style.left="0",o.style.top="0",o.style.opacity="0.001",document.body.appendChild(o);const n=e=>{var n;r||(null===(n=o.parentNode)||void 0===n||n.removeChild(o),r=!0,t(je(e)))},a=e=>{n(Array.prototype.slice.call(e.target.files))};o.addEventListener("input",a),o.addEventListener("change",a);const s=t=>{const o=()=>{n([])};r||("focusin"===t.type?tinymce.util.Delay.setEditorTimeout(e,o,1e3):o()),e.off("focusin remove",s)};e.on("focusin remove",s),o.click()})))(e).then((r=>{r.fold((()=>Mn(e,t)),(r=>{ua(e).each((n=>{Pn(0,n,(()=>Tn(e,r).then((r=>o(e,n,t,r))))).catch(zr(e))}))}))}))}})};r("uploadcare-local",Ma),r("uploadcare-replace-local",za);const o=(r,o)=>{e.ui.registry.addContextForm(r,{launch:{type:"contextformbutton",icon:"link",tooltip:"Upload from URL"},placeholder:"https://",label:"Upload from URL:",commands:[{type:"contextformbutton",tooltip:Cr,icon:"chevron-left",align:"start",onAction:e=>{e.back()}},{type:"contextformbutton",icon:"checkmark",tooltip:jr,align:"end",primary:!0,onAction:r=>{e.focus(),((e,t)=>{try{new URL(t)}catch(e){return!1}return!(e=>/.*\.[a-zA-Z]{3,4}$/i.test(e))(t)||be(Ar(e),(e=>{return r=t.toLowerCase(),o=`.${e.toLowerCase()}`,Ge(r,o,r.length-o.length);var r,o}))})(e,r.getValue())?ua(e).each((n=>{Pn(0,n,(()=>An(e,r.getValue()).then((r=>o(e,n,t,r))))).catch(zr(e))})):e.notificationManager.open({text:"Image URL is not correct",type:"error"})}}]})};o("uploadcare-url",Ma),o("uploadcare-replace-url",za),Ba(e);const n=(t,r)=>{la(e).each((e=>{t.setActive(((e,t)=>an(e,t).isSome())(e.src,r))}))};e.ui.registry.addToggleButton("uploadcare-invert",{tooltip:"Invert colors",icon:"invert",onSetup:e=>(n(e,"invert"),se),onAction:t=>{e.focus(),Sa(e),n(t,"invert")}}),e.ui.registry.addToggleButton("uploadcare-grayscale",{tooltip:"Grayscale",icon:"grayscale",onSetup:e=>(n(e,"grayscale"),se),onAction:t=>{e.focus(),Ca(e),n(t,"grayscale")}}),e.ui.registry.addButton("uploadcare-revert",{icon:"revert-changes",tooltip:"Revert",onAction:()=>{e.focus(),la(e).each((t=>((e,t)=>Ta((e=>((e,t)=>(xe(t.dom.getAttributeNames(),(e=>{ye(ha,e)||Yt(t,e)})),rn(e,me)))(e,t)),{imgUpdate:(e,t,r)=>hn(e,r)})(e))(e,Ot(t))))}})},qa={blur:{zero:10,min:10,max:100,keypoints:1},sharp:{zero:0,min:0,max:20,keypoints:1}},Da=e=>Ne(qa,e),Ka=(e,t,r)=>{const o=Math.min(e.length,t.length);return ve(o,(o=>r(e[o],t[o])))},Fa=(e,t,r)=>{const o=r-1;return ve(r,(r=>Math.ceil((r*t+(o-r)*e)/o)))},Va=(e,t,r)=>{const o=((e,t,r)=>{return Ee((o=e,Ae(o,((e,t,r)=>r<o.length-1?[...e,[t,o[r+1]]]:e),[])),(([e,r])=>e<=t&&t<=r)).map((o=>we(e,(e=>{const n=Math.abs(o[0]-o[1]),a=Math.abs(t-o[0])/n;return o[0]===e?t>r?1:1-a:o[1]===e?t>=r?a:1:0}))));var o})(e,t,r).getOr([]),n=((e,t)=>we(e,((r,o)=>r<t?e.length-o:o)))(e,r),a=Ka(o,n,((e,t)=>[e,t]));return Ka(e,a,((e,[t,r])=>({value:e,opacity:t,zIndex:r})))},Wa=async(e,t,r,o,n,a)=>{let s=((e,t)=>Va(((e,t)=>{const{min:r,max:o,zero:n,keypoints:a}=e;return[...new Set([...Fa(r,n,a+1),...Fa(n,o,a+1),n,t])].sort(((e,t)=>e-t))})(e,t),t,e.zero))(o,r),i=!1;const c=()=>{return"img",t=e=>_t(e,"img"),Te(we(e.dom.childNodes,Ot),t);var t},l=async e=>{n(!0);try{const t=await e;return n(!1),t}catch(e){throw n(!1),e}},u=async e=>{const r=jt("img");return Wt(r,"src",a(e)),ar(r,{position:"absolute",left:"0",top:"0",width:`${t.dom.clientWidth}px`,height:`${t.dom.clientHeight}px`}),await Lo(r),r},d=e=>{s=e,c().forEach(((t,r)=>{const o=e[r];ar(t,{opacity:String(o.opacity),"z-index":String(o.zIndex)})}))};return await(async()=>{ar(e,{position:"absolute",left:"0",top:"0"});const t=await l(Promise.all(we(s,(e=>u(e.value)))));xe(t,(t=>Ft(e,t))),d(s)})(),{update:e=>{d(((e,t,r)=>{const o=we(t,(e=>e.value));return Va(o,r,e.zero)})(o,s,e))},commit:e=>i?Promise.resolve():l(u(e)).then((t=>{i||((e,t,r)=>{const o=we(t,(e=>e.value)),n=((e,t)=>{for(let t=0,o=e.length;t<o;t++)if(e[t]>=r)return ge.some(t);return ge.none()})(o).getOr(0);return o[n]!==r?(o.splice(n,0,r),ge.some({index:n,keypoints:Va(o,r,e.zero)})):ge.none()})(o,s,e).each((({index:e,keypoints:r})=>{Ce(c(),e).each((e=>{Kt(e,t),d(r)}))}))})),destroy:()=>{c().forEach(Zt),i=!0}}},Ha=(e,t,r)=>qn(t).isSome()?Dn(e,t,r):((e,t,r)=>Da(t).map((o=>r===o.zero?tn(e,t):cn(e,t,Be(Math.floor(r),o.min,o.max)))).getOr(e))(e,t,r),Ga=(e,t,r,o)=>{e.undoManager.transact((()=>{Jt(t,"src").each((e=>{const n=Ha(e,r,o);Wt(t,"src",n),Wt(t,"data-mce-src",n),pn(t,(e=>Ha(e,r,o)))}))}))},Ja=(e,t,r)=>{const o=We();let n=0;const a=()=>{o.get().each((({previewer:e,overlay:t,commitAdjustmentThrottle:r})=>{e.destroy(),t.destroy(),r.cancel()})),o.clear()},s=(e,t)=>{o.get().each((({previewer:e,commitAdjustmentThrottle:r})=>{e.update(t),r.throttle(t)}))},i=(e,t)=>((e,t)=>sn(e,t).filter((e=>qn(t).isSome())))(e,t).or(((e,t)=>sn(e,t).filter((e=>Da(t).isSome())))(e,t)),c=(c,l,u,d)=>{qn(u).orThunk((()=>Da(u))).each((p=>{e.ui.registry.addContextForm(`uploadcare-adjust-${u}`,{type:"contextsliderform",launch:{type:"contextformtogglebutton",icon:d,tooltip:c,onSetup:t=>(la(e).each((e=>{t.setActive(((e,t)=>i(e,t).isSome())(e.src,u))})),se)},onSetup:t=>{let s=!1;const c=()=>{t.back(),e.focus()};e.on("ObjectResizeStart",c);const l=la(e).map(Ot).map((c=>{const l=i(c.dom.src,u).getOr(p.zero);return t.setValue(l),((e,t)=>xa(e,ce,t.dom))(e,c).then((()=>{if(!s){const s=t.getValue();Ga(e,c,u,s),(async(t,s,i,c)=>{a();const l=((e,t)=>{const r=Sn(e,t,se);return Ft(r.element,On({semiTransparentBackground:!1,whiteBackground:!1,spinner:!0,zIndex:ge.from("1298")})),r})(e,t),u=jt("div");yr(u,"tox-uc-adjustment-preview-container"),Ft(l.element,u);const d=await Wa(u,t,c,i,(e=>{e?n++:n--,fr(l.element,".tox-uc-loading-element").each((e=>{n>0?lr(e,"display"):nr(e,"display","none")}))}),(e=>Ha(t.dom.src,s,e))),p=et((t=>{d.commit(t).catch(Ir),o.get().each((({image:r})=>Ga(e,r,s,t)))}),r.colorAdjustmentDebounceTime);o.set({image:t,overlay:l,previewer:d,commitAdjustmentThrottle:p})})(c,u,p,s).catch(Ir)}})),c}));return()=>{s=!0,e.off("ObjectResizeStart",c),a(),l.each((r=>{((e,t)=>{const r=t.getAttribute("src");return Vo(t)&&null!==r&&Wo(e,r)})(e,r.dom)&&Ga(e,r,u,t.getValue())}))}},onInput:e=>s(0,e.getValue()),initValue:ie(p.zero),min:ie(p.min),max:ie(p.max),label:l,commands:[{type:"contextformbutton",icon:"chevron-left",tooltip:Cr,align:"start",onAction:r=>{a(),r.hide(),Mn(e,t)}},{type:"contextformbutton",text:Or,onAction:e=>{s(0,p.zero),e.setValue(p.zero)}}]})}))};c("Brightness","Brightness:","brightness","brightness"),c("Contrast","Contrast:","contrast","contrast"),c("Exposure","Exposure:","exposure","exposure"),c("Gamma","Gamma:","gamma","gamma"),c("Vibrance","Vibrance:","vibrance","vibrance"),c("Saturation","Saturation:","saturation","saturation"),c("Warmth","Warmth:","warmth","warmth"),c("Sharpen","Sharpen:","sharp","sharpen"),c("Blur","Blur:","blur","blur")},Xa=(e,t,r,o)=>{e.ui.registry.addContextToolbar("uploadcare-insert",{predicate:t=>{const r=Ot(t),o=e.schema.getTextBlockElements(),n=t=>t.dom===e.getBody();return!Xt(r,"data-mce-bogus")&&((e,t,r)=>mr(((e,t)=>_t(e,t)),hr,e,'table,[data-mce-bogus="all"]',r))(r,0,n).fold((()=>((e,t,r)=>((e,t,r)=>mr(((e,t)=>t(e)),gr,e,t,r))(e,t,r).isSome())(r,(t=>t.dom.nodeName.toLowerCase()in o&&e.dom.isEmpty(t.dom)),n)),pe)},items:e.hasPlugin("quickbars")?"quickimage":"uploadcare",position:"line",scope:"editor"}),e.ui.registry.addContextToolbar("uploadcare-placeholder",{predicate:Nn,items:"uploadcare-local uploadcare-url uploadcare-camera uploadcare-dropbox uploadcare-gdrive",position:"node",scope:"node"}),e.ui.registry.addContextToolbar("uploadcare-img",{predicate:e=>((e,t)=>(Vo(e)||Ho(e))&&!Nn(e)&&r.get().exists((e=>"uploadcare-img"===e)))(e),items:["uploadcare-subtoolbar-alignment","uploadcare-subtoolbar-transform","uploadcare-subtoolbar-adjust","uploadcare-subtoolbar-border","uploadcare-alt","uploadcare-caption",,"uploadcare-revert"].join(" "),position:"node",scope:"node"});const n={type:"contextformbutton",align:"start",icon:"chevron-left",tooltip:Cr,onAction:r=>{r.back(),Mn(e,t)}},a={type:"contextformtogglebutton",icon:"image-decorative",tooltip:"Decorative image",align:"start",onSetup:t=>{const r=va(e);return t.setActive(r),se},onAction:(e,t)=>{const r=!t.isActive();e.setInputEnabled(!r),t.setActive(r)}},s={type:"contextformbutton",icon:"checkmark",tooltip:jr,primary:!0,onAction:r=>{r.hide(),Mn(e,t),((e,t)=>{da(e,(r=>{const o=Ot(r);t.fold((()=>{Wt(o,"alt",""),Wt(o,"role","presentation")}),(t=>{Yt(o,"role"),""===t&&St(e)?Yt(o,"alt"):Wt(o,"alt",t)}))}),(r=>((e,t,r)=>{Do(e,t).each((t=>{const o=Ot(t);r.fold((()=>{Wt(o,"alt",""),Wt(o,"role","presentation")}),(t=>{Yt(o,"role"),""===t&&St(e)?Yt(o,"alt"):Wt(o,"alt",t)}))}))})(e,r,t)))})(e,r.isInputEnabled()?ge.from(r.getValue()):ge.none())}};e.ui.registry.addContextForm("uploadcare-alt",{launch:{type:"contextformbutton",tooltip:"Alt text",icon:"alt-text"},initValue:()=>(e=>pa(e,(e=>e.alt),(t=>((e,t)=>Do(e,t).map((e=>e.alt)).getOr(""))(e,t))).getOr(""))(e),label:"Alt text:",onSetup:t=>{const r=va(e);return t.setInputEnabled(!St(e)||!r),se},commands:St(e)?[n,a,s]:[n,s]}),Ja(e,t,o)},Ya=(e,t,r)=>{const o=We();o.set("uploadcare-img");const n=We();Xa(e,t,o,r),((e,t)=>{const r=r=>{e.focus(),t.set(r),e.nodeChanged()};e.ui.registry.addButton("uploadcare-subtoolbar-back-to-top",{tooltip:Cr,icon:"chevron-left",onAction:()=>r("uploadcare-img")}),xe([{name:"uploadcare-subtoolbar-transform",items:[{label:"Transform:",items:["uploadcare-rotate-counter","uploadcare-rotate","uploadcare-flip","uploadcare-mirror","uploadcare-resize-form"]}],tooltip:"Transform",icon:"transform-image"},{name:"uploadcare-subtoolbar-alignment",items:[{label:"Align:",items:["alignleft","aligncenter","alignright"]}],tooltip:"Align",icon:"align-left"},{name:"uploadcare-subtoolbar-replace",items:[{label:"Replace image:",items:["uploadcare-replace-local","uploadcare-replace-url","uploadcare-camera","uploadcare-dropbox","uploadcare-gdrive"]}],tooltip:"Replace",icon:"reload"},{name:"uploadcare-subtoolbar-adjust",items:[{label:"Adjust:",items:["uploadcare-adjust-brightness","uploadcare-adjust-contrast","uploadcare-adjust-exposure","uploadcare-adjust-gamma","uploadcare-adjust-vibrance","uploadcare-adjust-saturation","uploadcare-adjust-warmth","uploadcare-grayscale","uploadcare-invert","uploadcare-adjust-sharp","uploadcare-adjust-blur"]}],tooltip:"Adjust",icon:"adjustments"}],(o=>{e.ui.registry.addButton(o.name,{tooltip:o.tooltip,icon:o.icon,onAction:()=>r(o.name)}),e.ui.registry.addContextToolbar(o.name,{predicate:e=>((e,r)=>(Vo(e)||Ho(e))&&!Nn(e)&&t.get().exists((e=>e===r)))(e,o.name),items:Array.isArray(o.items)?[{items:["uploadcare-subtoolbar-back-to-top"]},...o.items]:"uploadcare-subtoolbar-back-to-top "+o.items,position:"node",scope:"node"})}))})(e,o),((e,t)=>{const r=We(),o=et(((t,r,o)=>{_a(e,r,o,Ot(t))}),300);e.ui.registry.addContextForm("uploadcare-resize-form",{type:"contextsizeinputform",launch:{type:"contextformbutton",icon:"resize",tooltip:"Resize"},onSetup:t=>{const o=()=>{t.back(),e.focus()};return la(e).each(r.set),e.on("ObjectResizeStart",o),()=>{r.clear(),e.off("ObjectResizeStart",o)}},initValue:()=>la(e).map((e=>({width:`${e.width}`,height:`${e.height}`}))).getOr({width:"0",height:"0"}),onInput:e=>{const{width:t,height:n}=e.getValue();Fe(r.get(),Ze(t),Ze(n),((e,t,r)=>o.throttle(e,t,r)))},label:"Constrain Proportions",commands:[{type:"contextformbutton",align:"start",icon:"chevron-left",tooltip:Cr,onAction:r=>{r.back(),Mn(e,t),e.nodeChanged()}},{type:"contextformbutton",text:Or,onAction:t=>{la(e).each((r=>{((e,t)=>Aa((e=>(async e=>{e.dom.srcset="",Yt(e,"srcset"),Yt(e,"width"),Yt(e,"height"),lr(e,"width"),lr(e,"height"),lr(e,"aspect-ratio"),Yt(e,"sizes"),Yt(e,ma),await er(e),nr(e,"width",`min(${e.dom.naturalWidth}px, 100%)`)})(e)),t)(e))(e,Ot(r)).then((()=>{t.setValue({width:String(r.width),height:String(r.height)})}))}))}}]})})(e,t),e.on("NodeChange",(e=>{n.get().exists((t=>t===e.element))||(n.set(e.element),o.set("uploadcare-img"))})),e.on("Blur",(()=>{n.clear(),o.set("uploadcare-img")}))},Qa=["tinydrive","moxiemanager","image","editimage"],Za=e=>t=>{if((e=>{const t=(e=>Te(Qa,(t=>e.hasPlugin(t))))(e);return!(t.length>0&&(e.on("Init",(()=>{e.notificationManager.open({text:"Unable to initialize uploadcare due to the presence of incompatible plugins. Details are in the browser console.",type:"error"})})),console.error(`Unable to initialize uploadcare due to the presence of incompatible plugins: ${t.join(", ")}`),1))})(t)){const r=(e=>{const t=We();return e.on("ObjectSelected",(e=>{(Vo(e.target)||Ho(e.target)||Nn(e.target))&&t.set(e.target)})),t})(t);(e=>{const t=e.options.register;t("uploadcare_cdn_base_url",{processor:e=>ft(e)?{valid:!0,value:yt(e)}:{valid:!1,message:"Needs to be a valid URL"},default:"https://ucarecdn.com/"}),t("uploadcare_upload_base_url",{processor:e=>ft(e)?{valid:!0,value:yt(e)}:{valid:!1,message:"Needs to be a valid URL"}}),t("uploadcare_public_key",{processor:"string"}),t("uploadcare_signed_upload_auth_provider",{processor:"function"}),t("uploadcare_srcset_steps",{processor:e=>Q(e)&&Se(e,(e=>ae(e)&&!Number.isNaN(e)&&Number.isFinite(e)))?{valid:!0,value:e}:{valid:!1,message:"srcset steps need to be an array of numbers."},default:[100,200,300,500,750,1e3,1250,1500,2e3,2500,3e3]}),t("uploadcare_store_type",{processor:e=>{const t=["auto","temporary","permanent"];return ye(t,e)?{valid:!0,value:e}:{valid:!1,message:`Store needs to be set to one of [${t.join(", ")}].`}},default:"permanent"})})(t),vn(t),Rn(t),Ya(t,r,e),La(t,r),(e=>{e.on("PreInit",(()=>{e.parser.addNodeFilter("figure",Fo(!0)),e.serializer.addNodeFilter("figure",Fo(!1))}))})(t),(e=>{e.on("ObjectResized",(t=>{Vo(t.target)&&(t.stopImmediatePropagation(),_a(e,t.width,t.height,Ot(t.target)))}))})(t)}};((e=En)=>{tinymce.PluginManager.requireLangPack("uploadcare","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_PT,pt_BR,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("uploadcare",Za(e))})()}();